<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>netstandard2.0</TargetFramework>
    <GeneratePackageOnBuild>false</GeneratePackageOnBuild>
    <Nullable>disable</Nullable>
    <Description>Generated C# interop structs for Windows kernel/user structures (explicit layout, FieldOffsets) created from PDB symbols.</Description>
    <PackageId>ntoskrnlib</PackageId>
    <Authors>ntoskrnlib</Authors>
    <RepositoryUrl>https://github.com/Rickebo/ntoskrnlib</RepositoryUrl>
    <RepositoryType>git</RepositoryType>
    <PackageProjectUrl>https://github.com/Rickebo/ntoskrnlib</PackageProjectUrl>
    <PackageLicenseExpression>MIT</PackageLicenseExpression>
    <GenerateDocumentationFile>false</GenerateDocumentationFile>
    <IncludeSymbols>false</IncludeSymbols>
    <PackageReadmeFile>README.md</PackageReadmeFile>
    <AssemblyName>ntoskrnlib</AssemblyName>
    <RootNamespace>ntoskrnlib</RootNamespace>
    <GenerateTypesDuringBuild>true</GenerateTypesDuringBuild>
  </PropertyGroup>

  <!-- Disable automatic compile includes to manually control what's included -->
  <PropertyGroup>
    <EnableDefaultCompileItems>false</EnableDefaultCompileItems>
    <EnableDefaultEmbeddedResourceItems>false</EnableDefaultEmbeddedResourceItems>
  </PropertyGroup>

  <!-- Include all generated files (unmanaged structs and managed wrappers) -->
  <!-- Build will fail if any generated files have syntax errors, forcing us to fix the generator -->
  <ItemGroup>
    <Compile Include="Generated\**\*.g.cs" />
  </ItemGroup>


  <ItemGroup>
    <None Include="README.md" Pack="true" PackagePath="/" />
  </ItemGroup>


  <ItemGroup>
    <Folder Include="Dynamic\" />
  </ItemGroup>


  <ItemGroup>
    <ProjectReference Include="..\ntoskrnlib.Common\ntoskrnlib.Common.csproj" />
  </ItemGroup>

  <!-- Auto-generate sources before compilation on Windows -->
  <Target Name="GenerateTypes" BeforeTargets="CoreCompile" Condition=" '$(OS)' == 'Windows_NT' and '$(GenerateTypesDuringBuild)' == 'true' and '$(SkipGenerateTypes)' != 'true' ">
    <Message Text="[ntoskrnlib] Generating sources into $(MSBuildProjectDirectory)\Generated" Importance="High" />
    <MakeDir Directories="$(MSBuildProjectDirectory)\Generated" />
    <Exec Command="dotnet run --project &quot;$(MSBuildThisFileDirectory)..\ntoskrnlib.Generator\ntoskrnlib.Generator.csproj&quot; -- --config &quot;$(MSBuildThisFileDirectory)..\config\types.yml&quot; -o &quot;$(MSBuildProjectDirectory)\Generated&quot; -w &quot;$(WindowsVersionLabel)&quot;" />
  </Target>
</Project>
